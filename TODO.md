# 地图相册 - 优化与功能待办清单

> 每完成一项标记为 [x]

## 优先级说明

| 标记 | 含义 | 建议 |
|------|------|------|
| 🔴 | 关键 - 影响核心体验 | 优先处理 |
| 🟠 | 重要 - 明显改善体验 | 尽快处理 |
| 🟡 | 建议 - 锦上添花 | 有空再做 |
| ⚪ | 待定 - 未来考虑 | 暂不处理 |

---

## 📊 进度统计

| 分类 | 已完成 | 进行中 | 待办 | 完成率 |
|------|--------|--------|------|--------|
| 性能优化 | 18 | 0 | 5 | 78% |
| 功能增强 | 13 | 0 | 22 | 37% |
| 代码质量 | 20 | 0 | 8 | 71% |
| 界面优化 | 4 | 0 | 9 | 31% |
| 测试完善 | 1 | 0 | 5 | 17% |
| **总计** | **56** | **0** | **49** | **53%** |

---

## ✅ 已完成

### 性能优化
- [x] 虚拟滚动 - react-window 优化长列表
- [x] 图片懒加载 - IntersectionObserver 精确控制
- [x] WebP 缩略图 - sharp 转换，体积减少 50%
- [x] 渐进式加载 - 先模糊占位图再高清
- [x] React.memo - 避免组件重复渲染
- [x] useDeferredValue - 搜索输入防抖
- [x] SQLite 索引 - lat/lng 复合索引
- [x] WAL 模式 - 提升数据库并发性能
- [x] GPU 加速 - CSS transform/will-change
- [x] 代码分割 - 懒加载组件
- [x] LRU 缓存系统 - 照片和缩略图智能缓存
- [x] 内存管理优化 - Blob URL 释放、定时清理
- [x] 粒子动画优化 - 减少粒子数量，提升启动性能

### 功能实现
- [x] 照片搜索 - 按备注内容搜索
- [x] 照片编辑 - 裁剪/旋转
- [x] 热力图模式 - 照片密度可视化
- [x] 标记入场动画
- [x] 骨架屏加载
- [x] 日志系统 - electron-log
- [x] 错误边界 - ErrorBoundary
- [x] iOS风格动画 - 弹窗和按钮过渡效果
- [x] 粒子变形加载器 - 地球→相机→相框动画
- [x] 快捷键支持 - 键盘快捷操作
- [x] 手势支持 - 双指缩放、滑动切换
- [x] 照片信息面板 - 详细信息侧边栏

### 部署与架构
- [x] 双版本架构 - Web版本和桌面版本
- [x] Netlify部署 - Web版本自动部署
- [x] GitHub Actions CI/CD - 自动构建和发布
- [x] Web版本适配 - IndexedDB存储
- [x] 桌面版本打包优化 - asar 压缩、文件过滤
- [x] 自动更新机制 - electron-updater
- [x] 代码签名配置 - entitlements.mac.plist
- [x] 多平台构建 - build-release.yml
- [x] CDN 配置 - 静态资源加速
- [x] PWA 支持 - Service Worker 离线缓存
- [x] SEO 优化 - meta 标签、sitemap

### 代码质量
- [x] 组件目录重组 - ui/photo/map/layout/monitor
- [x] 工具函数分类 - helpers.js
- [x] 常量统一管理 - constants/index.js
- [x] TypeScript 类型定义 - types/index.ts
- [x] API 层抽象 - api/index.js
- [x] Zustand 状态管理 - store/index.js
- [x] ESLint 配置 - .eslintrc.cjs
- [x] Prettier 配置 - .prettierrc
- [x] Husky + lint-staged - 提交前检查
- [x] JSDoc 注释规范 - jsdoc.config.json
- [x] PropTypes 类型检查 - propTypes.js
- [x] 性能分析工具 - performanceProfiler.js
- [x] Bundle 分析 - rollup-plugin-visualizer
- [x] VS Code 配置 - tasks.json/launch.json
- [x] Mock 数据 - mocks/index.js
- [x] Storybook 集成 - .storybook/
- [x] 开发文档 - CHANGELOG.md/DEVELOPMENT.md
- [x] 路径别名 - @components/@utils/@store
- [x] Vite 构建优化 - optimizeDeps/manualChunks
- [x] CSP 安全策略 - Content Security Policy

---

## 🔴 紧急优先级

### 性能瓶颈
- [ ] 🔴 Canvas 标记渲染 - 超过 200 个标记时使用 Canvas/WebGL 替代 DOM
- [ ] 🔴 内存占用优化 - 当前约 400MB，目标 250MB 以下
- [ ] 🔴 大量标记卡顿 - 500+ 标记时地图卡顿问题

### 核心功能缺失
- [ ] 🔴 数据备份恢复 - 防止数据丢失
- [ ] 🔴 批量导入照片 - 从文件夹导入带 GPS 的照片

---

## 🟠 高优先级

### 功能增强
- [ ] 🟠 EXIF 信息展示 - 拍摄时间、相机、光圈等
- [ ] 🟠 标记分组 - 按旅行/项目分组管理
- [ ] 🟠 数据导出 - JSON/GeoJSON/KML 格式
- [ ] 🟠 离线地图 - 下载区域供离线使用
- [ ] 🟠 标记聚合优化 - Supercluster 在 Worker 中计算
- [ ] 🟠 地图瓦片缓存限制 - 限制内存缓存数量

### 代码质量
- [ ] 🟠 安装包瘦身 - 排除不必要依赖，目标 < 80MB
- [ ] 🟠 单元测试覆盖 - 核心功能测试
- [ ] 🟠 组件测试 - React Testing Library

### 用户体验
- [ ] 🟠 深色模式 - 夜间主题支持
- [ ] 🟠 国际化 i18n - 多语言支持（中/英）
- [ ] 🟠 新手引导 - 首次使用引导教程

---

## 🟡 中优先级

### 功能增强
- [ ] 🟡 批量选择 - 多选照片删除/移动
- [ ] 🟡 照片排序 - 拖拽调整顺序
- [ ] 🟡 原图导出 - 导出到指定文件夹
- [ ] 🟡 标记标签 - 自定义标签筛选
- [ ] 🟡 标记合并 - 合并相近位置的标记
- [ ] 🟡 底图切换 - 卫星/街道/暗色切换
- [ ] 🟡 轨迹绘制 - 连接标记形成旅行轨迹
- [ ] 🟡 数据导入 - 从其他应用导入
- [ ] 🟡 云同步 - WebDAV/坚果云同步
- [ ] 🟡 高级搜索 - 按时间范围、地区筛选
- [ ] 🟡 搜索历史 - 记录最近搜索

### 界面优化
- [ ] 🟡 主题色自定义 - 自定义强调色
- [ ] 🟡 照片墙视图 - 网格瀑布流展示
- [ ] 🟡 幻灯片模式 - 自动播放照片
- [ ] 🟡 时间轴视图 - 按时间线展示
- [ ] 🟡 拖拽上传 - 拖拽照片到地图添加
- [ ] 🟡 右键菜单 - 更多操作选项

### 技术改进
- [ ] 🟡 完整 TS 迁移 - 将所有 .jsx 迁移为 .tsx
- [ ] 🟡 动态导入优化 - 路由级别代码分割
- [ ] 🟡 增量更新 - electron-updater 差量更新
- [ ] 🟡 帧率控制 - requestAnimationFrame 节流
- [ ] 🟡 大图流式加载 - 超大照片分块加载

### 测试完善
- [ ] 🟡 E2E 测试 - Playwright 关键流程测试
- [ ] 🟡 测试覆盖率 - 目标 80% 以上
- [ ] 🟡 性能基准测试 - 监控性能回归

---

## ⚪ 待定功能

### 创新功能
- [ ] ⚪ AI 照片描述 - 自动生成描述
- [ ] ⚪ 场景分类 - 识别美食/风景/人物
- [ ] ⚪ OCR 文字识别 - 识别照片文字
- [ ] ⚪ 智能标签 - 自动打标签
- [ ] ⚪ 年度报告 - 旅行年度总结
- [ ] ⚪ 足迹动画 - 按时间播放轨迹
- [ ] ⚪ 3D 地球 - 3D 展示足迹
- [ ] ⚪ 统计图表 - 旅行数据可视化

### 社交分享
- [ ] ⚪ 分享图片 - 生成精美分享图
- [ ] ⚪ 旅行报告 - PDF 旅行总结
- [ ] ⚪ 足迹地图 - 去过的省份/国家

### 游戏化
- [ ] ⚪ 成就系统 - 解锁旅行成就
- [ ] ⚪ 探索进度 - 省份/国家完成度
- [ ] ⚪ 旅行等级 - 根据足迹升级

### 平台扩展
- [ ] ⚪ 移动端适配 - React Native 或 PWA
- [ ] ⚪ 浏览器扩展 - Chrome/Firefox 扩展
- [ ] ⚪ API 开放 - 第三方应用集成
- [ ] ⚪ 云服务版本 - SaaS 服务模式

### 技术演进
- [ ] ⚪ 微前端架构 - 模块化开发和部署
- [ ] ⚪ WebAssembly - 图片处理性能提升
- [ ] ⚪ Web Workers - 后台任务处理
- [ ] ⚪ GraphQL API - 更灵活的数据查询
- [ ] ⚪ 实时协作 - WebSocket 多人协作
- [ ] ⚪ 插件系统 - 第三方扩展支持

---

## 🐛 已知问题

| 问题 | 优先级 | 状态 | 备注 |
|------|--------|------|------|
| 运行时内存占用过高（约 400MB） | 🔴 | 待修复 | 目标 250MB |
| 大量标记（500+）时地图卡顿 | 🔴 | 待修复 | 考虑 Canvas 渲染 |
| 照片查看器缩放后切换不重置 | 🟡 | 已知 | 有归位按钮 |
| 热力图在极低缩放时显示不明显 | 🟡 | 已知 | - |
| 设置弹窗样式偶发异常 | 🟡 | 待排查 | - |
| Windows 下中文路径可能出错 | 🟠 | 待验证 | - |
| macOS 首次启动权限提示 | 🟡 | 已知 | 需代码签名 |

---

## 📅 版本规划

### v1.1.0 - 稳定性优化（预计 2025-01）
**目标：提升稳定性和性能**
- [ ] 🔴 内存优化到 250MB 以下
- [ ] 🔴 Canvas 标记渲染
- [ ] 🔴 数据备份恢复
- [ ] 🟠 单元测试覆盖 50%

### v1.2.0 - 功能增强（预计 2025-02）
**目标：完善核心功能**
- [ ] 🟠 批量导入 GPS 照片
- [ ] 🟠 EXIF 信息展示
- [ ] 🟠 数据导出功能
- [ ] 🟠 深色模式

### v1.3.0 - 高级功能（预计 2025-03）
**目标：差异化功能**
- [ ] 🟠 离线地图下载
- [ ] 🟠 标记分组/标签
- [ ] 🟡 轨迹绘制
- [ ] 🟡 国际化支持

### v2.0.0 - 重大更新（预计 2025-Q2）
**目标：平台扩展**
- [ ] ⚪ 移动端适配
- [ ] ⚪ 云同步功能
- [ ] ⚪ AI 智能功能
- [ ] ⚪ 插件系统

---

## 📝 开发笔记

### 技术栈
- **前端**: React 18 + Vite + Zustand
- **桌面**: Electron 27
- **数据库**: SQLite (better-sqlite3) / IndexedDB (Web)
- **地图**: Mapbox GL JS
- **图片处理**: Sharp
- **测试**: Vitest + Playwright
- **CI/CD**: GitHub Actions

### 性能指标目标
| 指标 | 当前 | 目标 |
|------|------|------|
| 启动时间 | ~3s | < 2s |
| 内存占用 | ~400MB | < 250MB |
| 首屏渲染 | ~1.5s | < 1s |
| 标记渲染 | 200个流畅 | 1000个流畅 |
| 安装包大小 | ~120MB | < 80MB |

### 常用命令
```bash
npm run dev          # Electron 开发
npm run web:dev      # Web 开发
npm run build        # 构建前端
npm run dist         # 打包桌面应用
npm run test         # 运行测试
npm run lint         # 代码检查
npm run storybook    # 组件文档
```

---

最后更新: 2024-12-21
当前版本: v1.0.0
下一版本: v1.1.0 (稳定性优化)
